# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/common/ - папка с общими компонентами
- src/components/controllers/ - папка с контроллерами
- src/components/model/ - папка с моделями
- src/components/view/ - папка с отображениями
- src/types/ - папка с интерфейсами и типами

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Базовый код

### 1. Константы ```src/utils/Constants.ts```

В этом файле находятся все константы и настройки приложения, которые используются в разных частях проекта.

- ```API_URL: string``` - содержит базовый URL для API, формируется из переменной окружения ```process.env.API_ORIGIN```
- ```CDN_URL: string``` - содержит базовый URL для загрузки контента (изображений и т.д.), формируется из переменной окружения ```process.env.API_ORIGIN```
- ```SETTINGS``` - константа, которая содержит объект с настройками для различных компонентов пользовательского интерфейса (UI). Например, ```gallerySelector``` - селектор для контейнера галереи товаров или ```cardTemplate``` - ID шаблона карточки товара для каталога.

### 2. Утилиты ```src/utils/Utils.ts```

Этот файл содержит набор утилитных функций, которые используются для выполнения различных задач, таких как преобразование строк, работа с DOM (Document Object Model - представление HTML-документа в виде дерева), и другие вспомогательные операции.

Основные функции:
- ```pascalToKebab(value: string)``` - преобразует строку из PascalCase (например, MyComponent) в kebab-case (например, my-component).
- ```isSelector(x: any)``` - проверяет, является ли переданный аргумент x CSS-селектором (строкой).
- ```isEmpty(value: any)`` - проверяет, является ли переданное значение null или undefined.
- ```ensureAllElements<T>(selectorElement, context)``` - гарантирует, что возвращает массив DOM-элементов типа T. Она принимает CSS-селектор, NodeList или массив элементов и возвращает массив элементов. Аргумент context, который определяет, в каком контексте искать элементы.  По умолчанию, контекстом является весь документ (document).
- ```ensureElement<T>(selectorElement, context)``` - гарантирует, что возвращает один DOM-элемент типа T.  Она принимает CSS-селектор или элемент и возвращает элемент.
- ```cloneTemplate<T>(query)``` - клонирует содержимое HTML-шаблона. 
- ```bem(block, element, modifier)``` - генерирует имена классов в соответствии с методологией БЭМ (Блок, Элемент, Модификатор). Возвращает объект с именем и CSS-классом.
- ```setElementData<T | object>(el, data)``` - устанавливает значения data-атрибутов для HTML элемента
- ```getElementData<T>(el, scheme)``` - получает значения data-атрибутов из HTML-элемента и преобразует их в соответствии с заданной схемой.Аргумент scheme - объект, который определяет, как преобразовывать значения data-атрибутов.  Ключи объекта соответствуют именам data-атрибутов, а значения - функциям, которые принимают значение атрибута (строку) и возвращают преобразованное значение.
- ```function createElement<T>(tagName, props, children)``` - создает DOM-элемент с заданным тегом, свойствами и дочерними элементами.  Это упрощенная реализация фабрики DOM-элементов/

### 3. Система событий ```src/components/base/Events.ts```

Реализация системы событий (Event Emitter) для коммуникации между компонентами.

Класс EventEmitter - Реализует паттерн "Наблюдатель" для работы с событиями.

Поле - ```_events``` - Map, где ключи - имена событий, значения - Set функций-обработчиков.

Конструктор класса инициализирует поле ```_events``` новым экземпляром Map.

Методы:
- ```on(eventName, callback)``` - подписывает callback на событие eventName.
- ```off(eventName, callback)``` - отписывает callback от события eventName.
- ```emit(eventName, data)``` - метод для генерации события. 
- ```onAll(callback)``` - подписывает callback на все события.
- ```offAll()``` - удаляет все обработчики.
- ```trigger(eventName, context)``` - возвращает функцию, которая при вызове инициирует событие.

### 4. Работа с API-сервером ```src/components/base/api.ts```

Класс Api:
Поля:
- ```baseUrl: string``` - базовый URL API
- ```options: RequestInit``` - настройки для fetch запросов

Конструктор - инициализирует заголовок ```'Content-Type': 'application/json'``` и дополнительные переданные заголовки.

Методы:
- ```handleResponse(response)``` - обрабатывает ответ сервера.
- ```get(uri)``` - выполняет GET запрос. Возвращает Promise с результатом.
- ```post(uri, data, method)``` - Выполняет POST/PUT/DELETE запрос. По умолчанию method = 'POST'. data - объект для отправки (будет преобразован в JSON).

### 5. Состояние приложения ```src/components/appData.ts```

Класс AppState - управляет глобальным состоянием приложения.

Содержит поля данных корзины, товаров, заказа, ошибки, загрузку.

### 6. Работа с API-сервером для продуктов и заказов```src/components/productApi.ts```

Класс ProductApi - наследуется от класса Api и реализует конкретные методы для работы с Api.

Конструктор дополняет конструктор родителя дополнительным url.

Методы:
- ```getProductItem(id: string): Promise<IProduct>``` - получение товара
- ```getProductList(): Promise<IProduct[]>``` - получение списка товаров
- ```orderProducts(order: IOrder): Promise<IOrderResult>``` - отправка данных заказа

### 7. Модальные окна ```src/components/view/Modal.ts```

Класс, отвечающий за отображение модального окна.

Поля класса:
- ```closeButton``` - кнопка закрытия окна
- ```content``` - содержимое модального окна

Конструктор инициализирует поля класса, добавляет обработчик на кнопку закрытия и на клик на модальное окно.

Методы:
- ```open(): void``` - метод открытия модального окна
- ```close(): void``` - метод закрытия модального окна
- ```set Content(value: HTMLElement): void``` - устанавливает содержимое модального окна
- ```render(): void`` - отрисовка модального окна

## Модели
### 1. Модель корзины ```src/components/models/Basket.ts```

Модель корзины хранит информацию о выбранных товарах и их общей стоимости.

Поля класса:
- ```items: IProduct[] = []``` - инициализируется пустым массивом товаров.
- ```totalPrice: number = 0``` - начальная стоимость корзины 0

Методы:
- ```addItem(product: IProduct): void``` - добавляет товар в корзину.
Добавляет товар в массив items. Вызывает updateTotalPrice() для пересчета суммы.
- ```removeItem(productId: string): void``` - удаляет товар из корзины.
Фильтрует массив товаров (items), оставляя только товары с несовпадающим ID. Вызывает updateTotalPrice() для пересчета суммы.
- ```clear(): void``` - полностью очищает корзину.
Очищает массив товаров. Сбрасывает итоговую сумму товаров в корзине в 0.
- ```updateTotalPrice(): void``` - приватный метод для пересчёта общей стоимости корзины.
Вычисляет общую стоимость корзины и присваивает ее свойству totalPrice. Использует метод reduce массива для вычисления суммы цен всех товаров в корзине.

### 2. Модель заказа ```src/components/models/Order.ts```

Модель заказа хранит информацию о способе оплаты, доставке и контактах покупателя. Используется как DTO (Data Transfer Object) для передачи данных о заказе.

Поля класса:
- ```payment: string | null``` - способ оплаты
- ```address: string | null``` - адрес доставки
- ```email: string | null``` - электронная почта
- ```phone: string | null``` - телефон
- ```items: string[] | null``` - список id товаров
- ```total: number | null``` - общая стоимость

### 3. Модель товара ```src/components/models/Product.ts```

Модель товара описывает структуру и характеристики товара в магазине.

Поля класса:
- ```id: string``` - уникальный идентификатор товара
- ```title: string``` - название товара
- ```category: string``` - категория товара
- ```price: number``` - стоимость товара
- ```image: string``` - URL изображения товара
- ```description: string``` - описание товара

Конструктор класса принимает объект типа IProduct. Копирует все свойства из переданного объекта в поля класса.

## Отображения

### 1. Строка товара в корзине ```src/components/views/BasketCardView.ts```

Отображение карточки товара в корзине.

Поля класса:
- ```container: HTMLElement``` - шаблон строки
- ```index: HTMLElement``` - номер строки
- ```title: HTMLElement``` - название товара
- ```price: HTMLElement``` - цена товара
- ```button: HTMLButtonElement``` - кнопка удаления товара
- ```eventEmitter: EventEmitter``` - объект для отправки и получения событий

Конструктор класса принимает объект событий и шаблон строки, записывает в поля класса шаблон карточки и необходимые элементы из шаблона

Методы:
- ```render(product: IProduct, index: number): HTMLElement``` - заполняет шаблон данными и возвращает отрисованную карточку

### 2. Отображение корзины ```src/components/views/BasketView.ts```

Отображение содержимого корзины и взаимодействие с пользователем.

Поля класса:
- ```eventEmitter: EventEmitter``` - объект для отправки и получения событий
- ```container: HTMLElement``` - шаблон корзины
- ```list: HTMLElement``` - список товаров
- ```total: HTMLElement``` - итоговая сумма товаров
- ```button: HTMLElement``` - кнопка перехода к оформлению заказа

Конструктор принимает объект событий и шаблон элемента, записывает в поля класса шаблон карточки и необходимые элементы из шаблона.

Методы:
- ``` render(basket: IBasket): HTMLElement``` - отображает корзину. 
Клонирует шаблон корзины. Получает список товаров и отображает их в шаблон. Отображает общую сумму. Добавляет обработчик на кнопку оформления заказа.

### 3. Форма контактов ```src/components/views/ContactsView.ts```

Отображает форму ввода контактных данных и валидирует их.

Поля класса:
- Элементы формы: ```container```, ```emailInput```, ```phoneInput``` 
- ```submitButton``` - кнопка отправки формы
- ```errors``` - элемент для отображения ошибок валидации
- ```eventEmitter``` - объект EventEmitter для отправки событий

Конструктор принимает объект событий (eventEmitter) и сохраняет его в поле.

Методы:
- ```render()``` - отображает форму контактов.
Загружает шаблон формы. Находит все элементы формы. Добавляет оброботчики взаимодействия с элементами формы. Добавляет обработчик отправки формы.
- ```setValidState(isValid: boolean, error?: string): void``` - отображение ошибок и блокировка кнопки далее
- ```resetForm()``` - сбрасывает значения полей формы

### 4. Форма заказа ```src/components/views/OrderView.ts```

Отображает форму выбора способа оплаты и ввода адреса.

Поля класса:
- Элементы формы: ```container```, ```paymentButtons```, ```onlineButton```, ```cashButton```, ```addressInput```, ```submitButton```, ```errors```
- ```eventEmitter``` - объект EventEmitter для отправки событий

Конструктор принимает объект событий и шаблон формы и сохраняет их в поля.

Методы:
- ```render()``` - отображает форму контактов.
Загружает шаблон формы. Находит все элементы формы. Добавляет обработчики событий. Возвращает готовую форму
- ```setPaymentMethod(method: string): void``` - устанавливает выбранный способ оплаты
- ```setAddress(value: string): void``` - установка адреса доставки
- ```setValidState(isValid: boolean, error?: string): void``` - установка состояния валидности формы
- ```setListeners(): void``` - устанавливаются прослушиватели на поля и форму
- ```resetForm()``` - сбрасывает значения полей формы и снимает активный класс с кнопок

### 5. Главная страницы ```src/components/view/PageView.ts```

Класс, отвечающий за отображение основных элементов страницы (счетчик корзины, галерея товаров).

Поля класса:
- ```basketCounter: HTMLElement``` - элемент счетчика товаров в корзине.
- ```basketButton: HTMLElement``` - кнопка открытия корзины
- ```gallery: HTMLElement``` - элемент галереи товаров.
- ```eventEmitter: EventEmitter``` - объект для управления событиями (например, открытие корзины)
- ```_wrapper``` - обёртка страницы

Конструктор принимает на вход объект событий, сохраняет его в поле, получает DOM-элементы для остальных полей, добавляет обработчик события на кнопку корзины

Методы:
- ```setBasketCounter(value: number): void``` - установка значения счётчика корзины
- ```updateGallery(cards: HTMLELEMENT[]): void``` - обновление галереи товаров
- ```setlocked(value: boolean)``` - блокирует/отменяет блокировку страницы 

### 6. Карточка товара ```src/components/views/ProductCardView.ts```

Отображает карточку товара в каталоге.

Методы:
- ```render(product: IProduct)``` - заполняет шаблон карточки товара.
Создает карточку из шаблона. Заполняет данные товара (название, категория. цвет категории, цена, изображение). Возвращает готовый DOM-элемент.

### 7. Детали товара ```src/components/views/ProductModalView.ts```

Отображает детальную информацию о товаре в модальном окне.

Поля класса:
- ```eventEmitter``` - объект EventEmitter для отправки событий
- ```isInBasket``` - флаг наличия товара в корзине
- ```product``` - объект класс Product
- ```buyButton``` - кнопка добавления в корзину

Конструктор принимает объект событий (eventEmitter) и сохраняет его в поле.

Методы:
- ```render(product: IProduct): HTMLElement``` - отображает детали товара.
Загружает шаблон модального окна. Находит все элементы модального окна.  Добавляет обработчик добавления/удаления элемента в(из) корзину(ы).
- ```setEventListener(): void``` - установка прослушивателей
- ```setIsInBasket(isInBasket: boolean): void``` - изменение флага наличия товара в корзине
- ```updateButtonState(): void``` - изменение надписи в кнопке

### 8. Успешное оформление ```src/components/views/SuccessView.ts```

Показывает сообщение об успешном оформлении заказа.

Поля класса:
- ```content: HTMLElement``` - содержимое окна успеха
- ```closeButton: HTMLButtonElement``` - кнопка закрытия окна

Конструктор инициалзирует элементы, которые будут использоваться в render

Методы:
- ```render(totalPrice: number): HTMLElement``` - отображает сообщение об успешном оформлении заказа и итоговую стоимость заказа.
Загружает шаблон модального окна. Находит элемент модального окна с итоговой стоимостью. Добавляет обработчик на закрытия окна на кнопку продолжения покупок.
- ```getCloseButton(): HTMLButtonElement``` - получение кнопки закрытия окна

## Контроллеры

### 1. Контроллер корзины товаров ```src/components/controllers/BasketController.ts```

Класс, управляющий корзиной товаров. Отвечает за добавление, удаление товаров из корзины, отображение корзины и обновление иконки корзины на странице.

Поля класса:
- ```basket: Basket``` - модель корзины, хранит товары и общую стоимость.
- ```events: EventEmitter``` - объект для управления событиями (добавление, удаление товара, открытие корзины)
- ```basketView: IBasketView``` - отображение корзины
- ```modalController: ModalController``` - контроллер модального окна
- ```basketRowTemplate: HTMLTemplateElement``` - шаблон строки корзины

Конструктор принимает объекты событий, корзины, отображения корзины, контроллера модального окна, создаёт экземпляры для полей, подписывается на события добавления/удаления и открытия корзины.

Методы:
- ```handleProductAdd(product: IProduct)``` - добавляет товар в корзину и обновляет счетчик в иконке корзины.
- ```handleProductRemove(data: { productId: string })``` - удаляет товар из корзины по ID и обновляет счетчик в иконке корзины
- ```handleBasketOpen()``` - метод для отображения содержимого в модальном окне корзины
- ```updateBasketCounter()``` - метод для обновления счетчика товаров
- ```createBasketRows(): HTMLElement[]``` - создаёт массив из HTMLElement строк корзины

### 2. Контроллер заказов ```src/components/controllers/OrderController.ts```

Класс, управляющий оформлением заказа.  Отвечает за отображение форм заказа, валидацию данных, отправку заказа и отображение страницы успешного завершения.

Поля:
- ```order: Order``` - модель заказа, хранит данные о заказе (способ оплаты, адрес доставки, контакты)
- ```events: EventEmitter``` - объект для управления событиями, связанными с оформлением заказа
- ```orderView: IOrderView``` - форма заказа
- ```contactsView: IContactsView``` - форма контактов
- ```basket: Basket``` - корзина товаров
- ```modalController: ModalController``` - модальное окно для отображения форм и страницы успеха
- ```api``` - объект для взаимодействия с ProductApi

Конструктор принимает объекты событий для подписки, заказа, отображения первого окна заказа, отображения второго окна заказа, объекта Api, контроллера модального окна, создаёт экземпляры для полей, подписывается на события.

Методы:
- ```handleOrderOpen()``` - показывает форму ввода данных заказа
- ```handlePaymentChange(data: { method: string })``` - изменение метода оплаты
- ```handleAddressChange(data: { value: string })``` - изменение адреса доставки
- ```handleOrderSubmit()``` - завершение ввода данных первого окна заказа
- ```handleOrderValidate()``` - валидация данных первого окна заказа
- ```handleContactsValidate()``` - валидация данных второго окна заказа
- ```handleContactsSubmit(data: { email: string, phone: string })``` - завершение ввода данных второго окна заказа
- ```handleOrderSubmitConfirmed()``` - отправка данных заказ на сервер. В случае успеха открывает модальное окно успеха, в случае ошибки выводит сообщение об ошибке

### 3. Контроллер товаров ```src/components/controllers/OrderController.ts```

Управляет загрузкой и отображением товаров.

Поля класса:
- ```api: Api``` - для работы с API
- ```eventEmitter: EventEmitter``` - для работы с событиями
- ```pageView: PageView``` - объект страницы
- ```modalController: ModalController``` - объект контроллера модального окна

Конструктор принимает экземпляры Api, EventEmitter, PageView и ModalController, инициализирует представления и подписывается на событие открытия окна.

Методы:
- ```loadProducts()``` - асинхронный метод, загружающий список продуктов с сервера.
Загружает товары с сервера через API. Преобразует данные в массив объектов Product. Рендерит карточки товаров в галерее. Добавляет обработчики кликов для открытия деталей товара.
- ```displayProducts(products: IProduct[])``` - отображает галерею товаров
- ```handleProductOpen(product: IProduct)``` - отображает модальное окно с подробными данными

### 4. Контроллер модального окна ```src/components/controllers/ModalController.ts```

Класс отвечающий за работу модальных окон

Поля:
- ```modal: Modal``` - объект модального окна
- ```events: EventEmitter``` - объект событий

Конструктор принимает модальное окно и объект событий, инициализирует поля класса

Методы:
- ```openModal(content: HTMLElement)``` - устанавливает контент и открывает модальное окно
- ```closeModal()``` - закрывает модальное окно