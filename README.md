# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Базовый код

### 1. Константы ```src/utils/Constants.ts```

В этом файле находятся все константы и настройки приложения, которые используются в разных частях проекта.

- ```API_URL: string``` - содержит базовый URL для API, формируется из переменной окружения ```process.env.API_ORIGIN```
- ```CDN_URL: string``` - содержит базовый URL для загрузки контента (изображений и т.д.), формируется из переменной окружения ```process.env.API_ORIGIN```
- ```SETTINGS``` - константа, которая содержит объект с настройками для различных компонентов пользовательского интерфейса (UI). Например, ```gallerySelector``` - селектор для контейнера галереи товаров или ```cardTemplate``` - ID шаблона карточки товара для каталога.

### 2. Утилиты ```src/utils/Utils.ts```

Этот файл содержит набор утилитных функций, которые используются для выполнения различных задач, таких как преобразование строк, работа с DOM (Document Object Model - представление HTML-документа в виде дерева), и другие вспомогательные операции.

Основные функции:
- ```pascalToKebab(value: string)``` - преобразует строку из PascalCase (например, MyComponent) в kebab-case (например, my-component).
- ```isSelector(x: any)``` - проверяет, является ли переданный аргумент x CSS-селектором (строкой).
- ```isEmpty(value: any)`` - проверяет, является ли переданное значение null или undefined.
- ```ensureAllElements<T>(selectorElement, context)``` - гарантирует, что возвращает массив DOM-элементов типа T. Она принимает CSS-селектор, NodeList или массив элементов и возвращает массив элементов. Аргумент context, который определяет, в каком контексте искать элементы.  По умолчанию, контекстом является весь документ (document).
- ```ensureElement<T>(selectorElement, context)``` - гарантирует, что возвращает один DOM-элемент типа T.  Она принимает CSS-селектор или элемент и возвращает элемент.
- ```cloneTemplate<T>(query)``` - клонирует содержимое HTML-шаблона. 
- ```bem(block, element, modifier)``` - генерирует имена классов в соответствии с методологией БЭМ (Блок, Элемент, Модификатор). Возвращает объект с именем и CSS-классом.
- ```setElementData<T | object>(el, data)``` - устанавливает значения data-атрибутов для HTML элемента
- ```getElementData<T>(el, scheme)``` - получает значения data-атрибутов из HTML-элемента и преобразует их в соответствии с заданной схемой.Аргумент scheme - объект, который определяет, как преобразовывать значения data-атрибутов.  Ключи объекта соответствуют именам data-атрибутов, а значения - функциям, которые принимают значение атрибута (строку) и возвращают преобразованное значение.
- ```function createElement<T>(tagName, props, children)``` - создает DOM-элемент с заданным тегом, свойствами и дочерними элементами.  Это упрощенная реализация фабрики DOM-элементов/

### 3. Система событий ```src/components/base/Events.ts```

Реализация системы событий (Event Emitter) для коммуникации между компонентами.

Класс EventEmitter - Реализует паттерн "Наблюдатель" для работы с событиями.

Поле - ```_events``` - Map, где ключи - имена событий, значения - Set функций-обработчиков.

Конструктор класса инициализирует поле ```_events``` новым экземпляром Map.

Методы:
- ```on(eventName, callback)``` - подписывает callback на событие eventName.
- ```off(eventName, callback)``` - отписывает callback от события eventName.
- ```emit(eventName, data)``` - метод для генерации события. 
- ```onAll(callback)``` - подписывает callback на все события.
- ```offAll()``` - удаляет все обработчики.
- ```trigger(eventName, context)``` - возвращает функцию, которая при вызове инициирует событие.

### 4. Работа с API-сервером ```src/components/base/api.ts```

Класс Api:
Поля:
- ```baseUrl: string``` - базовый URL API
- ```options: RequestInit``` - настройки для fetch запросов

Конструктор - инициализирует pаголовок ```'Content-Type': 'application/json'``` и дополнительные переданные заголовки.

Методы:
- ```handleResponse(response)``` - обрабатывает ответ сервера.
- ```get(uri)``` - выполняет GET запрос. Возвращает Promise с результатом.
- ```post(uri, data, method)``` - Выполняет POST/PUT/DELETE запрос. По умолчанию method = 'POST'. data - объект для отправки (будет преобразован в JSON).

## Модели
### 1. Модель корзины ```src/types/models/Basket.ts```

Модель корзины хранит информацию о выбранных товарах и их общей стоимости.

Поля класса:
- ```items: IProduct[] = []``` - инициализируется пустым массивом товаров.
- ```totalPrice: number = 0``` - начальная стоимость корзины 0

Методы:
- ```addItem(product: IProduct): void``` - добавляет товар в корзину.
Добавляет товар в массив items. Вызывает updateTotalPrice() для пересчета суммы.
- ```removeItem(productId: string): void``` - удаляет товар из корзины.
Фильтрует массив товаров (items), оставляя только товары с несовпадающим ID. Вызывает updateTotalPrice() для пересчета суммы.
- ```clear(): void``` - полностью очищает корзину.
Очищает массив товаров. Сбрасывает итоговую сумму товаров в корзине в 0.
- ```updateTotalPrice(): void``` - приватный метод для пересчёта общей стоимости корзины.
Вычисляет общую стоимость корзины и присваивает ее свойству totalPrice. Использует метод reduce массива для вычисления суммы цен всех товаров в корзине.

### 2. Модель заказа ```src/types/models/Order.ts```

Модель заказа хранит информацию о способе оплаты, доставке и контактах покупателя. Используется как DTO (Data Transfer Object) для передачи данных о заказе.

Поля класса:
- ```paymentMethod: string | null = null``` - способ оплаты
- ```deliveryAddress: string | null = null``` - адрес доставки
- ```email: string | null = null``` - электронная почта
- ```phone: string | null = null``` - телефон

### 3. Модель товара ```src/types/models/Product.ts```

Модель товара описывает структуру и характеристики товара в магазине.

Поля класса:
- ```id: string``` - уникальный идентификатор товара
- ```name: string``` - название товара
- ```category: string``` - категория товара
- ```price: number``` - стоимость товара
- ```image: string``` - URL изображения товара
- ```description: string``` - описание товара

Конструктор класса принимает объект типа IProduct. Копирует все свойства из переданного объекта в поля класса.

## Отображения

### 1. Отображение корзины ```src/types/views/BasketView.ts```

Отображение содержимого корзины и взаимодействие с пользователем.

Поля класса:
- ```modal: HTMLElement``` - контейнер модального окна
- ```content: HTMLElement``` - содержимое модального окна
```list: HTMLElement``` - список товаров
```totalPrice: HTMLElement``` - элемент для отображения общей суммы
```eventEmitter: EventEmitter``` - объект для отправки и получения событий

Конструктор принимает объект событий (eventEmitter) и находит DOM-элементы модального окна, присваивая их полям класса.

Методы:
- ```render(basket: IBasket)``` - отображает корзину. 
Клонирует шаблон корзины. Для каждого товара создает элемент через renderBasketItem(). Отображает общую сумму. Добавляет обработчик на кнопку оформления заказа.
- ```renderBasketItem(product: IProduct, index: number)``` - отображает строку для одного товара в корзине.
Создает элемент товара из шаблона. Заполняет данные (номер, название, цена). Добавляет обработчик удаления товара.
- ```openModal()/closeModal()``` - управляют классом активности модального окна.

### 2. Форма контактов ```src/types/views/Contacts.ts```

Отображает форму ввода контактных данных и валидирует их.

Поля класса:
- Элементы формы: form, emailInput, phoneInput, submitButton, errors
- modal и content - модальное окно и его содержимое
- eventEmitter - объект EventEmitter для отправки событий

Конструктор принимает объект событий (eventEmitter) и находит DOM-элементы модального окна, присваивая их полям класса.

Методы:
- ```render()``` - отображает форму контактов.
Загружает шаблон формы. Находит все элементы формы. Настраивает валидацию при вводе. Добавляет обработчик отправки формы.
- ```validate()``` - выполняет валидацию форм.
Проверяет заполненность полей. Блокирует/разблокирует кнопку отправки. Показывает/скрывает ошибки.
- ```openModal()/closeModal()``` - управляют классом активности модального окна.

### 3. Форма заказа ```src/types/views/OrderView.ts```

Отображает форму выбора способа оплаты и ввода адреса.

Поля класса:
- Элементы формы: form, paymentButtons, addressInput, submitButton, errors
- modal и content - модальное окно и его содержимое
- eventEmitter - объект EventEmitter для отправки событий

Конструктор принимает объект событий (eventEmitter) и находит DOM-элементы модального окна, присваивая их полям класса.

Методы:
- ```render()``` - отображает форму контактов.
Загружает шаблон формы. Находит все элементы формы. Настраивает валидацию при вводе. Добавляет обработчик отправки формы.
- ```validate()``` - выполняет валидацию форм.
Проверяет нажатие кнопки типа оплаты и заполненность поля адреса. Блокирует/разблокирует кнопку отправки. Показывает/скрывает ошибки.
- ```openModal()/closeModal()``` - управляют классом активности модального окна.

### 4. Карточка товара ```src/types/views/ProductCardView.ts```

Отображает карточку товара в каталоге.

Методы:
- ```render(product: IProduct)``` - заполняет шаблон карточки товара.
Создает карточку из шаблона. Заполняет данные товара (название, категория, цена, изображение). Возвращает готовый DOM-элемент.

### 5. Детали товара ```src/types/views/ProductModalView.ts```

Отображает детальную информацию о товаре в модальном окне.

Поля класса:
- modal и content - модальное окно и его содержимое
- eventEmitter - объект EventEmitter для отправки событий

Конструктор принимает объект событий (eventEmitter) и находит DOM-элементы модального окна, присваивая их полям класса.

Методы:
- ```render()``` - отображает детали товара.
Загружает шаблон модального окна. Находит все элементы модального окна.  Добавляет обработчик добавления/удаления элемента в(из) корзину(ы).
- ```openModal()/closeModal()``` - управляют классом активности модального окна.

### 6. Успешное оформление ```src/types/views/SuccessView.ts```

Показывает сообщение об успешном оформлении заказа.

Поля класса:
- modal и content - модальное окно и его содержимое

Конструктор находит DOM-элементы модального окна, присваивая их полям класса.

Методы:
- ```render()``` - отображает сообщение об успешном оформлении заказа и итоговую стоимость заказа.
Загружает шаблон модального окна. Находит элемент модального окна с итоговой стоимостью.  Добавляет обработчик на закрытия окна на кнопку продолжения покупок.
- ```openModal()/closeModal()``` - управляют классом активности модального окна.

## Контроллеры

### 1. Контроллер корзины товаров ```src/types/controllers/BasketController.ts```

Управляет добавлением/удалением товаров и отображением корзины.

Поля класса:
- ```basket: Basket``` - экземпляр модели корзины
- ```eventEmitter: EventEmitter``` - для работы с событиями
- ```basketView: IBasketView``` - представление корзины

Конструктор принимает объект событий (eventEmitter), находит DOM-элементы корзины, присваивая их полям класса, подписывается на события добавления/удаления товаров.

Методы:
- ```addToBasket(product: IProduct): void``` - добавляет товар в корзину и обновляет счетчик в иконке корзины.
- ```removeFromBasket(productId: string): void``` - удаляет товар из корзины по ID и обновляет счетчик в иконке корзины
- ```showBasket(): void``` - открывает модальное окно корзины
- ```updateBasketIcon(): void``` - приватный метод для обновления счетчика товаров.
Находит элемент счетчика в DOM и обновляет его значение.

### 2. Контроллер заказов ```src/types/controllers/OrderController.ts```

Управляет процессом оформления заказа, включая ввод данных доставки и контактов.

Поля:
- ```order: Order``` - модель заказа
- ```eventEmitter: EventEmitter``` - для работы с событиями
- ```orderView: IOrderView``` - форма заказа
- ```contactsView: IContactsView``` - форма контактов
- ```successView: ISuccessView``` - окно успешного заказа
- ```basket: Basket``` - корзина товаров

Конструктор принимает экземпляр EventEmitter в качестве аргумента, bнициализирует переменные класса: создает новые экземпляры модели заказа Order, формы заказа OrderView (с передачей eventEmitter), формы контактов ContactsView (с передачей eventEmitter), окна успешного оформления SuccessView и модели корзины Basket.

Методы:
- ```showOrderForm(): void``` - показывает форму ввода данных заказа
- ```submitOrder(orderData: IOrder): void``` - сохраняет данные заказа (адрес, способ оплаты) и переходит к форме контактов
- ```showContactsForm(): void``` - показывает форму ввода контактных данных
- ```submitContacts(orderData: IOrder): void``` - сохраняет контактные данные (email, телефон) и завершает оформление заказа
- ```completeOrder(): void``` - выполняет действия, необходимые для завершения заказа
Показывает окно успешного оформления. Очищает корзину. Отправляет событие basket:clear, чтобы другие части приложения отреагировали на очистку корзины

### 3. Контроллер товаров ```src/types/controllers/OrderController.ts```

Управляет загрузкой и отображением товаров.

Поля класса:
- ```api: Api``` - для работы с API
- ```eventEmitter: EventEmitter``` - для работы с событиями
- ```productCardView: IProductCardView``` - карточка товара
- ```productModalView: IProductModalView``` - модальное окно товара

Конструктор принимает экземпляры Api и EventEmitter, инициализирует представления.

Методы:
- ```loadProducts(): Promise<void>``` - асинхронный метод, загружающий список продуктов с сервера.
Загружает товары с сервера через API. Преобразует данные в массив объектов Product. Рендерит карточки товаров в галерее. Добавляет обработчики кликов для открытия деталей товара.
- ```showProductModal(productId: string): void``` - загружает детальную информацию о товаре и отображает модальное окно с подробными данными